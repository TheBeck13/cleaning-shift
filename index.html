<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Cleaning Shift Assignment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html, body { 
      height: 100%; 
      margin: 0; 
      padding: 0; 
      font-family: Arial, sans-serif; 
      background: #f7f7f7; 
    }
    body {
      max-width: 98vw;
      min-height: 100vh;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1.5rem 0.5rem;
      box-sizing: border-box;
    }
    h1, h2 {
      margin-top: 0.5em;
    }
    #login-section, #shifts-section {
      width: 100%;
      max-width: 410px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.12);
      padding: 1.5em 1.2em;
      margin-bottom: 2.5em;
      box-sizing: border-box;
    }
    label {
      display: block;
      margin: 0.8em 0 0.2em 0;
      font-size: 1.05em;
    }
    input[type="text"], input[type="password"] {
      width: 100%;
      font-size: 1em;
      padding: 0.7em;
      margin-bottom: 1em;
      border-radius: 6px;
      border: 1px solid #bbb;
      box-sizing: border-box;
      background: #f9f9f9;
      transition: box-shadow 0.2s;
    }
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      box-shadow: 0 0 3px 2px #2b90d9;
      border-color: #2b90d9;
    }
    button {
      width: 100%;
      padding: 1em;
      font-size: 1.12em;
      color: #fff;
      background: #3476e4;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.7em;
      margin-bottom: 0.4em;
      transition: background 0.2s;
    }
    button:hover {
      background: #285db3;
    }
    .error {
      color: #d82243;
      margin-top: 0.5em;
      min-height: 1.3em;
      font-size: 1em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      font-size: 1em;
      overflow-x: auto;
      background: #f9faff;
      border-radius: 4px;
      box-shadow: 0 0 2px #ddd;
    }
    th, td {
      border: 1px solid #e0e0e0;
      padding: 0.65em 0.45em;
      text-align: left;
    }
    th {
      background: #e7f0fa;
    }
    /* Scroll tables on mobile */
    #current-shifts, #previous-shifts {
      display: block;
      overflow-x: auto;
      width: 100%;
    }
    @media (max-width: 600px) {
      body {
        padding: 0.4em 0.1em;
      }
      #login-section, #shifts-section {
        max-width: 99vw;
        padding: 1em 0.5em;
        border-radius: 0;
        box-shadow: none;
      }
      h1, h2 {
        font-size: 1.22em;
      }
      button {
        font-size: 1em;
        padding: 0.9em;
      }
      table, th, td {
        font-size: 0.98em;
      }
    }
    @media (max-width: 400px) {
      table, th, td { font-size: 0.9em;}
      #login-section, #shifts-section { padding: 0.6em; }
    }
  </style>
</head>
<body>
  <h1>Cleaning Shifts Login</h1>
  <div id="login-section">
    <label>Username:
      <input type="text" id="username" autocomplete="username">
    </label>
    <label>Password:
      <input type="password" id="password" autocomplete="current-password">
    </label>
    <button onclick="handleLogin()">Login</button>
    <div id="login-error" class="error hidden">Username o password errati!</div>
  </div>

  <div id="shifts-section" class="hidden">
    <h2>Turni di questa settimana</h2>
    <div style="overflow-x:auto"><table id="current-shifts"></table></div>
    <h2>Turni della settimana precedente</h2>
    <div style="overflow-x:auto"><table id="previous-shifts"></table></div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    const VALID_USERNAME = "GGE";
    const PASSWORD_HASH = "8ae99689531ec58c39142f634ce7b4dd9466d8a9a399cbcfa13f6f50e2272876";

    const persons = ["Genni", "Giuspi", "Eld"];
    const shifts = ["Main Room", "Kitchen", "Bathroom"];

    function getWeekNumber(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      const weekNo = Math.floor(((d - yearStart) / 86400000 + 1) / 7);
      return weekNo;
    }

    function calculateAssignments(offset) {
      const week = getWeekNumber(new Date()) + offset;
      const result = [];
      for(let i=0; i<persons.length; i++) {
        result.push([persons[i], shifts[(i + week)%3]]);
      }
      return result;
    }

    function renderTable(tableId, data) {
      let html = "<tr><th>Nome</th><th>Turno</th></tr>";
      for(const [name, shift] of data) {
        html += `<tr><td>${name}</td><td>${shift}</td></tr>`;
      }
      document.getElementById(tableId).innerHTML = html;
    }

    async function sha256(str) {
      const utf8 = new TextEncoder().encode(str);
      const hashBuffer = await crypto.subtle.digest('SHA-256', utf8);
      return Array.from(new Uint8Array(hashBuffer)).map(b=>b.toString(16).padStart(2,"0")).join('');
    }

    async function handleLogin() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      const hash = await sha256(p);
      if(u === VALID_USERNAME && hash === PASSWORD_HASH) {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("shifts-section").classList.remove("hidden");
        renderTable("current-shifts", calculateAssignments(0));
        renderTable("previous-shifts", calculateAssignments(-1));
        document.getElementById("login-error").classList.add("hidden");
      } else {
        document.getElementById("login-error").classList.remove("hidden");
      }
    }

    function logout() {
      document.getElementById("login-section").classList.remove("hidden");
      document.getElementById("shifts-section").classList.add("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }
    </script>
</body>
</html>
